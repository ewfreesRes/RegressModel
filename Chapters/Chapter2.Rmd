
# Basic Linear Regression

**Chapter description**

This chapter considers regression in the case of only one explanatory variable. Despite this seeming simplicity, many deep ideas of regression can be developed in this framework. By limiting ourselves to the one variable case, we can illustrate the relationships between two variables graphically. Graphical tools prove to be important for developing a link between the data and a predictive model.


```{r comment = "", echo = FALSE, eval = FALSE, warning = FALSE}
# Reformat Data
Lot <- read.table("CSVData\\WiscLottery.csv",header = TRUE, sep = ",")
str(Lot)
cor(Lot)
Lot$pop <- Lot$POP
Lot$sales <- Lot$SALES
Lot$medhome <- Lot$MEDHVL
Lot2 <- Lot[c("pop","sales","medhome")]
#write.csv(Lot2,"CSVData\\Wisc_lottery.csv",row.names = FALSE)


outlr <- read.csv("CSVData\\OutlierExample.csv", header = TRUE)
str(outlr)
outlr$y <- outlr$Y 
outlr$x <- outlr$X
outlr$codes <- outlr$CODES
outlr2 <- outlr[c("x","y","codes")]
#write.csv(outlr2,"CSVData\\Outlier.csv",row.names = FALSE)
```

## Correlation

***

In this section, you learn how to:

- Calculate and interpret a correlation coefficient
- Interpret correlation coefficients by visualizing scatter plots

***

###Video 

<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25916071/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_qlpe86qi&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;&wid=1_w18zht77" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player"></iframe>
</center>

#### Video Overhead Details {-}

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Over2.1A')">A Details. Wisconsin lottery data description</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.1B')">B Details. Summary statistics</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.1C')">C Details. Visualizing skewed distributions</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.1D')">D Details. Visualizing relationships with a scatter plot</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.1E')">E Details. Correlation coefficient</button>
</div>


<div id="Over2.1A" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>A Details. Wisconsin lottery data description</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2, warning = FALSE, message = FALSE}
Lot <- read.csv("CSVData\\Wisc_lottery.csv")
#Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
str(Lot)
```

</p>
</div>

<div id="Over2.1B" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>B Details. Summary statistics</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2, warning = FALSE, message = FALSE}
#options(scipen = 100, digits = 4)
#numSummary(Lot[,c("pop", "sales")], statistics = c("mean", "sd", "quantiles"), quantiles = c(0,.5,1))
(as.data.frame(psych::describe(Lot)))[,c(2,3,4,5,8,9)]
#Rcmdr::numSummary(Lot[,c("pop", "sales")], statistics = c("mean", "sd", "quantiles"), quantiles = c(0,.5,1))
```

</p>
</div>

<div id="Over2.1C" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>C Details. Visualizing skewed distributions</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2, warning = FALSE, message = FALSE}
par(mfrow = c(1, 2))
hist(Lot$pop, main = "", xlab = "population")
hist(Lot$sales, main = "", xlab = "sales")
```

</p>
</div>

<div id="Over2.1D" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>D Details. Visualizing relationships with a scatter plot</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2, warning = FALSE, message = FALSE}
plot(Lot$pop, Lot$sales, xlab = "population", ylab = "sales")
```

</p>
</div>

<div id="Over2.1E" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>E Details. Correlation coefficient</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2, warning = FALSE, message = FALSE}
cor(Lot$pop, Lot$sales)
```

</p>
</div>


###Exercise. Correlations and the Wisconsin lottery

**Assignment Text**
  
The Wisconsin lottery dataset, `Wisc_lottery`,has already been read into a dataframe `Lot`.

Like insurance, lotteries are uncertain events and so the skills to work with and interpret lottery data are readily applicable to insurance. It is common to report sales and population in thousands of units, so this exercise gives you practice in rescaling data via linear transformations.

**Instructions**

- From the available population and sales variables, create new variables in the dataframe `Lot`, `pop_1000` and `sales_1000` that are in thousands (of people and of dollars, respectively).
- Create summary statistics for the dataframe that includes these new variables.
- Plot `pop_1000` versus `sales_1000`.
- Calculate the correlation between `pop_1000` versus `sales_1000` using the function [cor()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/cor). How does this differ between the correlation between population and sales in the original units?

```{r ex="ExerRegMod2.1.2", type="hint", tut=TRUE}
Use the dataframe to refer to pop and sales as `Lot$pop` and `Lot$sales`, respectively
```

```{r ex="ExerRegMod2.1.2", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
```

```{r ex="ExerRegMod2.1.2", type="sample-code", tut=TRUE}
# Create new variables, say, `pop_1000` and `sales_1000`
Lot$pop_1000 <- ___
___ <- Lot$sales/1000

# Create summary statistics for the dataframe
summary(___)

# Plot `pop_1000` versus `sales_1000`.
plot(___, ___)

# Calculate the correlation between `pop_1000` versus `sales_1000` 
cor(___, ___)

```


```{r ex="ExerRegMod2.1.2", type="solution", tut=TRUE}
Lot$pop_1000 <- Lot$pop/1000
Lot$sales_1000 <- Lot$sales/1000
summary(Lot)
plot(Lot$pop_1000, Lot$sales_1000)
cor(Lot$pop_1000, Lot$sales_1000)

```


```{r ex="ExerRegMod2.1.2", type="sct", tut=TRUE}
ex() %>% check_object("Lot") %>% {
  check_column(., "pop_1000") %>% check_equal(incorrect_msg="Please create a column that is equal to the population divided by 1000")
  check_column(., "sales_1000") %>% check_equal(incorrect_msg="Please create a column that is equal to the sales divided by 1000")
}
ex() %>% check_function("summary",not_called_msg="Use the `summary` function to examine the dataframe `lot`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to examine `lot` after creating `pop_1000` and sales_1000")
ex() %>% check_function("plot",not_called_msg="Create a plot of pop_1000 and sales_1000") %>%{
  check_arg(., "x") %>% check_equal(incorrect_msg="the independant variable should be `pop_1000`.")
  check_arg(., "y") %>% check_equal(incorrect_msg="the dependant variable should be `sales_1000`.")
}
ex() %>% check_function("cor",not_called_msg="use the `cor` function to examing the correlation between `pop_1000` and `sales_1000`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to use `pop_1000` and `sales_1000`.")
success_msg("Congratulations! We will rescale data using 'linear' transformations regularly. In part we do this for communicating our analysis to others. Also in part, this is for our own convenience as it can allow us to see patterns more readily.")
```


## Method of least squares

***

In this section, you learn how to:

- Fit a line to data using the method of least squares
- Predict an observation using a least squares fitted line

***

###Video 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25916071/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_6finvcp7&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;&wid=1_5pgz5f8p" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player"></iframe>

</center>


#### Video Overheads

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Over2.2A')">A Details. Where to fit the line?</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.2B')">B Details. Method of least squares</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.2C')">C Details. Regression coefficients</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.2D')">D Details. Prediction</button>
</div>

<div id="Over2.2A" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>A Details. Where to fit the line?</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_blr <- lm(sales ~ pop, data = Lot)
plot(Lot$pop, Lot$sales,xlab = "population", ylab = "sales")
abline(model_blr, col="blue")
abline(0,1, col="red")
```

</p>
</div>

<div id="Over2.2B" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>B Details. Method of least squares</h3>
  <p>

- For observation $\{(y, x)\}$, the height of the regression line is $$b_0 + b_1 x.$$
- Thus, $y - (b_0 + b_1 x)$ represents the deviation.
- The sum of squared deviations is $$SS(b_0, b_1) = \sum (y - (b_0 + b_1 x))^2 .$$
- The *method of least squares* -- determine values of $b_0, b_1$ that minimize $SS$.

</p>
</div>

<div id="Over2.2C" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>C Details. Regression coefficients</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_blr <- lm(sales ~ pop, data = Lot)
round(coefficients(model_blr), digits=4)
plot(Lot$pop, Lot$sales,xlab = "population", ylab = "sales")
abline(model_blr, col="blue")
```

</p>
</div>

<div id="Over2.2D" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>D Details. Prediction</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
round(coefficients(model_blr), digits=6)
coefficients(model_blr)[1] + coefficients(model_blr)[2]*30000

newdata <- data.frame(pop = 30000)
predict(model_blr, newdata)
```

</p>
</div>


###Exercise. Least squares fit using housing prices

**Assignment Text**

The prior video analyzed the effect that a zip code's population has on lottery sales. Instead of population, suppose that you wish to understand the effect that housing prices have on the sale of lottery tickets. The dataframe `Lot`, read in from the Wisconsin lottery dataset  `Wisc_lottery`, contains the variable `medhome` which is the median house price for each zip code, in thousands of dollars. In this exercise, you will get a feel for the distribution of this variable by examining summary statistics, examine its relationship with sales graphically and via correlations, fit a basic linear regression model and use this model to predict sales.

**Instructions**

- Summarize the dataframe `Lot` that contains `medhome` and `sales`.
- Plot `medhome` versus `sales`. Summarize this relationship by calculating the corresponding correlation coefficient using the function [cor()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/cor).
- Using the function [lm()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/lm), regress `medhome`, the explanatory variable, on `sales`, the outcome variable. Display the regression coefficients to four significant digits.
- Use the function [predict()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/predict) and the fitted regression model to predict sales assuming that the median house price for a zip code is 50 (in thousands of dollars).

```{r ex="ExerRegMod2.2.2", type="hint", tut=TRUE}
Creating a Linear model using `lm()` creates an object with a large ammount of information, which can be used with the `predict()` function in addition with a dataframe with the same columns as your model to examine out of sample data.
```

```{r ex="ExerRegMod2.2.2", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)

```

```{r ex="ExerRegMod2.2.2", type="sample-code", tut=TRUE}
# Summarize the dataframe `Lot` that contains `medhome` and `sales`
summary(Lot)
# Plot and calculate the correlation of `medhome` versus `sales`. 
cor(___, ___)
plot(___, ___)

# Regress `medhome`  on `sales`. Display the regression coefficients to four significant digits.
model_blr1 <- lm(___ ~ ___, data = Lot)
round(coefficients(model_blr1), digits= ---)

# Predict sales assuming that the median house price is 50 
newdata <- data.frame(medhome = ___)
predict(model_blr1, newdata)

```

```{r ex="ExerRegMod2.2.2", type="solution", tut=TRUE}
summary(Lot)
cor(Lot$medhome,Lot$sales)
plot(Lot$medhome,Lot$sales)
model_blr1 <- lm(sales ~ medhome, data = Lot)
round(coefficients(model_blr1), digits=4)
newdata <- data.frame(medhome = 50)
predict(model_blr1, newdata)

```

```{r ex="ExerRegMod2.2.2", type="sct", tut=TRUE}
ex() %>% check_function("cor",not_called_msg="Make sure to find the correlation between `medhome` and `sales`") %>% check_result() %>% check_equal(incorrect_msg="Make sure to use `medhome` and `sales`.")
ex() %>% check_function("plot",not_called_msg="Create a plot showing `medhome` and `sales`.") %>% {
  check_arg(., "x") %>% check_equal(incorrect_msg="The independant variable should be `medhome`")
  check_arg(., "y") %>% check_equal(incorrect_msg="The independant variable should be `sales`")
}
ex() %>% check_object("model_blr1",undefined_msg="Create a model under the name of `model_blr1`.") %>% check_equal(incorrect_msg="make sure to model `sales` based on `medhome`")
ex() %>% check_function("lm") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="make sure to model `sales` based on `medhome`")
  check_arg(., "data") %>% check_equal(incorrect_msg="Make sure to specify which dataframe your data is in.")
}
ex() %>% check_function("round",not_called_msg="Please round the coefficients before using them.") %>% {
  check_arg(., "x") %>% check_equal(incorrect_msg="Make sure to round the coefficients found using our linear model.")
  check_arg(., "digits") %>% check_equal(incorrect_msg="Please round to 4 digits")
}
ex() %>% check_object("newdata",undefined_msg="Please create some data under the name of `newdata`.") %>% check_equal(incorrect_msg="All that is needed is to create a dataframe, where `medhome` equals 50.")
ex() %>% check_function("predict",not_called_msg="Make sure to use the predict function to create estimates based on our `newdata`") %>% {
  check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify we want to use the model `model_blr1`.")
  check_arg(., "newdata") %>% check_equal(incorrect_msg="Make sure to specify we want to use `newdata` as our new data.")
}
success_msg("Congratulations! You now have experience fitting a regression line and using this line for predictions, just as Galton did when he used parents' heights to predict the height of an adult child. Well done!")
```


## Understanding variability

***

In this section, you learn how to:

- Visualize the ANOVA decomposition of variability
- Calculate and interpret $R^2$, the coefficient of determination
- Calculate and interpret $s^2$ the mean square error
- Explain the components of the ANOVA table

***

###Video 

<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25916071/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=1_a6j1eyc0&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;&wid=1_x5oq2i5k" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player"></iframe>
</center>

#### Video Overhead Details {-}


<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Over2.3A')">A and B Details. Visualizing the uncertainty about a line</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.3C')">C, D and E Details. ANOVA Table</button>
</div>


<div id="Over2.3A" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>A and B Details. Visualizing the uncertainty about a line</h3>
  <p>

```{r comment = ""}
par(mar=c(2.2,2.1,.2,.2),cex=1.2)
x <- seq(-4, 4, len=101)
y <- x
plot(x, y, type = "l", xlim=c(-3, 4), xaxt="n", yaxt="n", xlab="", ylab="")
axis(1, at = c(-1, 1),lab = expression(bar(x), x))
axis(2, at = c(-1, 1, 3),lab = expression(bar(y), hat(y), y), las=1)
abline(-1, 0, lty = 2)
segments(-4, 1, 1, 1, lty=2)
segments(-4, 3, 1, 3, lty = 2)
segments(1, -4, 1, 3, lty = 2)
segments(-1, -4, -1, -1, lty = 2)

points(1, 3, cex=1.5, pch=19)

arrows(1.0, 1, 1.0, 3, code = 3, lty = 1, angle=15, length=0.12, lwd=2)
text(1.3, 2.2,   expression( y-hat(y)),cex=0.8) 
text(-.3,2.2,"'unexplained' deviation", cex=.8) 
arrows(1.0, -1, 1.0, 1, code = 3, lty = 1, angle=15, length=0.12, lwd=2)
text(1.85, 0, expression(hat(y)-bar(y) == b[1](x-bar(x)) ), cex=0.8 )
text(2.1, -0.5, " 'explained' deviation", cex=0.8)
arrows(-1, -1.0, 1, -1.0, code = 3, lty = 1, angle=15, length=0.12, lwd = 2)
text(0, -1.3, expression( x-bar(x)), cex=0.8  )
text(3.5, 2.7, expression( hat(y)== b[0]+ b[1]*x), cex=0.8  )
```

</p>
</div>

<div id="Over2.3C" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>C, D and E Details. ANOVA Table</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_blr <- lm(sales ~ pop, data = Lot)
anova(model_blr)
sqrt(anova(model_blr)$Mean[2])
summary(model_blr)$r.squared

```

</p>
</div>

###Exercise. Summarizing measures of uncertainty 

**Assignment Text**

In a previous exercise, you developed a regression line to fit the variable `medhome`, the median house price for each zip code, as a predictor of lottery sales. The regression of `medhome` on `sales` has been summarized in the `R` object `model_blr`.

How reliable is the regression line? In this excercise, you will compute some of the standard measures that are used to summarize the goodness of this fit.

**Instructions**

- Summarize the fitted regression model in an ANOVA table.
- Determine the size of the typical residual, $s$.
- Determine the coefficient of determination, $R^2$.  

```{r ex="ExerRegMod2.3.2", type="hint", tut=TRUE}
Learn more about possibilities through the `Rdocumentation` site. If you have not done so already, check out the function [anova()](https://www.rdocumentation.org/packages/stats/versions/3.5.1/topics/anova)
```

```{r ex="ExerRegMod2.3.2", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
```

```{r ex="ExerRegMod2.3.2", type="sample-code", tut=TRUE}
model_blr <- lm(sales  ~ medhome, data = Lot)

# Summarize the fitted regression model in an ANOVA table.
anova(___)

# Determine the size of the typical residual, $s$.
sqrt(anova(___)$Mean[2])

# Determine the coefficient of determination, $R^2$. 
summary(___)$r.squared

```


```{r ex="ExerRegMod2.3.2", type="solution", tut=TRUE}
model_blr <- lm(sales  ~ medhome, data = Lot)
anova(model_blr)
sqrt(anova(model_blr)$Mean[2])
summary(model_blr)$r.squared

```


```{r ex="ExerRegMod2.3.2", type="sct", tut=TRUE}
ex() %>% check_object("model_blr",undefined_msg="Make sure to create a new model named ` model_blr`") %>% check_equal(incorrect_msg="Create the model so that `sales` are based on `medhome`")
ex() %>% check_function("lm",not_called_msg="Make sure to use `lm` to create a linear model of the data.") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="Make sure to create the model so that `sales` are based on `medhome`.")
  check_arg(., "data") %>% check_equal(incorrect_msg="Make sure to specify that our data comes from the dataframe `Lot`.")
}
ex() %>% check_function("anova",not_called_msg="Make sure to use the `anova` function to summarize the regression fit") %>% check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify that we would like to run `anova` based on `model_blr`.")
ex() %>% check_function("sqrt",not_called_msg="Make sure to take the square root of the results of the `anova` call.") %>% check_result() %>% check_equal(incorrect_msg="make sure to specify the correct `anova` argument!")
ex() %>% check_function("summary", not_called_msg="Make sure to view the summary of our model.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify that we want to view the r-squared value from our summary.")
success_msg("Congratulations! It will be helpful if you compare the results of this exercise to the regression of `pop` on `sales` from the prior video. We have seen that `pop` is more highly correlated with `sales` than `medhome`, so we are expecting greater uncertainty in this regression fit.")

```

###Exercise. Effects of linear transforms on measures of uncertainty

**Assignment Text**

Let us see how rescaling, a linear transformation, affects our measures of uncertainty. As before, the Wisconsin lottery dataset  `Wisc_lottery` has been read into a dataframe `Lot` that also contains `sales_1000`, sales in thousands of dollars, and `pop_1000`, zip code population in thousands. How do measures of uncertainty change when going from the original units to thousands of those units?

**Instructions**

- Run a regression of `pop` on `sales_1000` and summarize this in an ANOVA table.
- For this regression, determine the $s$ and the coefficient of determination, $R^2$.  
- Run a regression of `pop_1000` on `sales_1000` and summarize this in an ANOVA table.
- For this regression, determine the $s$ and the coefficient of determination, $R^2$. 

**Hint.** The residual standard error is also available as `summary(model_blr1)$sigma`. The coefficient of determination is also available as `summary(model_blr1)$r.squared`.

```{r ex="ExerRegMod2.3.3", type="hint", tut=TRUE}
The residual standard error is also available as `summary(model_blr1)$sigma`. The coefficient of determination is also available as `summary(model_blr1)$r.squared`.
```

```{r ex="ExerRegMod2.3.3", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
Lot$pop_1000 <- Lot$pop/1000
Lot$sales_1000 <- Lot$sales/1000
```

```{r ex="ExerRegMod2.3.3", type="sample-code", tut=TRUE}
# Run a regression of `pop` on `sales_1000` and summarize this in an ANOVA table.
model_blr1 <- lm(sales_1000  ~ pop, data = Lot)
anova(___)

# Determine the $s$ and the coefficient of determination, $R^2$.  
sqrt(anova(___)$Mean[2])
summary(___)$r.squared

# Run a regression of `pop_1000` on `sales_1000` and summarize this in an ANOVA table.
model_blr2 <- lm(___  ~ ___, data = Lot)
anova(model_blr2)

# Determine the $s$ and the coefficient of determination, $R^2$. 
___
___
```
 

```{r ex="ExerRegMod2.3.3", type="solution", tut=TRUE}
model_blr1 <- lm(sales_1000  ~ pop, data = Lot)
anova(model_blr1)
sqrt(anova(model_blr1)$Mean[2])
summary(model_blr1)$r.squared
model_blr2 <- lm(sales_1000  ~ pop_1000 , data = Lot)
anova(model_blr2)
sqrt(anova(model_blr2)$Mean[2])
summary(model_blr2)$r.squared

```



```{r ex="ExerRegMod2.3.3", type="sct", tut=TRUE}
ex() %>% check_object("model_blr1", undefined_msg="Please name the first regression model `model_blr1`.") %>% check_equal(incorrect_msg="Please do not change this step, it should read `model_blr1 <- lm(sales_1000 ~ pop, data = Lot)`.")
ex() %>% check_function("anova", index=1, not_called_msg="Use `anova` to summarize the fit of `model_blr1`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify that we want to run `anova` on `model_blr1`.")
ex() %>% check_function("sqrt", index=1, not_called_msg="Make sure to take the square root in order to find `s`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure you are taking the square root of the second argument of the mean found using `anova`.")
ex() %>% check_function("summary", index=1, not_called_msg="Use `summary` to find the summary statistics of `model_blr1`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify that we want the r-squared value from our model.")
ex() %>% check_object("model_blr2", undefined_msg="Please name the first regression model `model_blr2`.") %>% check_equal(incorrect_msg="Make sure to create `model_blr2` such that `sales_1000` is based on `pop_1000`.")
ex() %>% check_function("lm", index=2, not_called_msg="make sure to use `lm` to create a regression model.") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="make sure to specify we would like `sales_1000` to be based on `pop_1000`.")
  check_arg(., "data") %>% check_equal(incorrect_msg="make sure to specify that our data is from the dataframe `Lot`.")
}
ex() %>% check_function("anova",index=3,not_called_msg="Use `anova` to summarize the fit of `model_blr2`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify that we want to run `anova` on `model_blr2`.")
ex() %>% check_function("sqrt",index=2,not_called_msg="Make sure to take the square root in order to find `s`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure that you are taking the square root of the second argument of the mean found using `anova`.")
ex() %>% check_function("anova",index=4, not_called_msg="make sure to run `anova` on `model_blr2`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify that we would like to run `anova` on `model_blr2`.")
ex() %>% check_function("summary", index=2, not_called_msg="Use `summary` to find the summary stats on `model_blr2`.") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify we want the r-squared value from our model.")
success_msg("Congratulations! In this exercise, you have seen that rescaling does not affect our measures of goodness of fit in any meaningful way. For example, coeffcient of determinations are completely unaffected. This is helpful because we will rescale variables extensively in our search for patterns in the data.")

```

## Statistical inference

***

In this section, you learn how to:

- Conduct a hypothesis test for a regression coefficient using either a rejection/acceptance procedure or a p-value
- Calculate and interpret a confidence interval for a regression coefficient
- Calculate and interpret a prediction interval at a specific value of a predictor variable

***

###Video 

<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25916071/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=0_s9a4jr3s&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;&wid=1_quj4d5r0" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player"></iframe>
</center>

#### Video Overhead Details {-}

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Over2.4A')">A Details. Summary of basic linear regression model</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.4B')">B Details. Hypothesis testing</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.4C')">C Details. Confidence intervals</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.4D')">D Details. Confidence intervals check</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.4E')">E Details. Prediction intervals</button>
</div>


<div id="Over2.4A" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>A Details. Summary of basic linear regression model</h3>
  <p>

Introduce the output in the *summary* of the basic linear regression model.

```{r comment = "", eval = EVALUATE_CHAP2}
Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
#Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
#options(scipen = 8, digits = 4)
model_blr <- lm(sales ~ pop, data = Lot)
summary(model_blr)

```

</p>
</div>


<div id="Over2.4B" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>B Details. Hypothesis testing</h3>
  <p>

```
> summary(model_blr)$coefficients
            Estimate Std. Error t value  Pr(>|t|)
(Intercept) 469.7036  702.90619  0.6682 5.072e-01
pop           0.6471    0.04881 13.2579 1.158e-17
```

</p>
</div>

<div id="Over2.4C" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>C Details. Confidence intervals</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
confint(model_blr, level = .90)
confint(model_blr, level = .95)

```

</p>
</div>

<div id="Over2.4D" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>D Details. Confidence intervals check</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
# Just for checking
summary(model_blr)$coefficients[2,1]
summary(model_blr)$coefficients[2,2]
qt(.975, 48)

summary(model_blr)$coefficients[2,1] - 
  summary(model_blr)$coefficients[2,2]*qt(.975, 48)

confint(model_blr, level = .95)
confint(model_blr, level = .95)

```

</p>
</div>


<div id="Over2.4E" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>E Details. Prediction intervals</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
NewData <- data.frame(pop = 10000)
predict(model_blr, NewData, interval = "prediction", level = .90)
predict(model_blr, NewData, interval = "prediction", level = .99)

```

</p>
</div>

###Exercise. Statistical inference and Wisconsin lottery

**Assignment Text**

In a previous exercise, you developed a regression line with the variable `medhome`, the median house price for each zip code, as a predictor of lottery sales. The regression of `medhome` on `sales` has been summarized in the `R` object `model_blr`.
  
This exercise allows you to practice the standard inferential tasks: hypothesis testing, confidence intervals, and prediction.

**Instructions**

- Summarize the regression model and identify the *t*-statistic for testing the importance of the regression coefficient associated with `medhome`.
- Use the function [confint()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/confint) to provide a 95\% confidence interval for the regression coefficient associated with `medhome`.
- Consider a zip code with a median housing price equal to 50 (in thousands of dollars). Use the function [predict()](https://www.rdocumentation.org/packages/stats/versions/3.5.0/topics/predict) to provide a point prediction and a 95\% prediction interval for sales.

```{r ex="ExerRegMod2.4.2", type="hint", tut=TRUE}
Taking a [summary()] of a regression object produces a new objeect. You can use the [str()] structure command to learn more about the new object. Try out a command such as `str(summary(model_blr))`
```

```{r ex="ExerRegMod2.4.2", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
```

```{r ex="ExerRegMod2.4.2", type="sample-code", tut=TRUE}
model_blr1 <- lm(sales ~ medhome, data = Lot)
# Summarize the regression model and identify the $t$-statistic for testing the importance of the regression coefficient associated with `medhome`.
summary(___)
summary(___)$coefficients
summary(___)$coefficients[,3]

# Provide a 95\% confidence interval for the regression coefficient associated with `medhome`.
confint(___, level = ___)

# Provide a point prediction and a 95\% prediction interval for sales.
NewData1 <- data.frame(medhome = 50)
predict(___, NewData1, interval = "prediction", level = ___)

```



```{r ex="ExerRegMod2.4.2", type="solution", tut=TRUE}
model_blr1 <- lm(sales ~ medhome, data = Lot)
summary(model_blr1)
summary(model_blr1)$coefficients
summary(model_blr1)$coefficients[,3]

confint(model_blr1, level = .95)

NewData1 <- data.frame(medhome = 50)
predict(model_blr1, NewData1, interval = "prediction", level = .95)

```


```{r ex="ExerRegMod2.4.2", type="sct", tut=TRUE}
ex() %>% check_object("model_blr1",undefined_msg="Make sure the first regression model is named `model_blr1`.") %>% check_equal(incorrect_msg="Make sure that `model_blr1` is created by modeling `sales` based on `medhome`.")
ex() %>% check_function("lm",not_called_msg="Make sure to use `lm` to create a linear model. ") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="Make sure to create a model so that `sales` are based on `medhome`.")
  check_arg(., "data") %>% check_equal(incorrect_msg="Make sure to specify that our data comes from `Lot`.")
}
ex() %>% check_function("summary",index=1,not_called_msg="Please use `summary` to find summary results. ") %>% check_arg("object") %>% check_equal(incorrect_msg="Make sure to specify we want to take the summary of `model_blr1`.")
ex() %>% check_function("summary",index=2,not_called_msg="Please use `summary` to find summary results. ") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify we want to find the coefficients using the summary of `model_blr1`.")
ex() %>% check_function("summary",index=3,not_called_msg="Please use `summary` to find summary results. ") %>% check_result() %>% check_equal(incorrect_msg="Make sure to specify we want to find the t-stat using the summary of `model_blr1`." )
ex() %>% check_function("confint",not_called_msg="Make sure to use `confint` to create a confidence interval. ") %>% {
  check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify that we want to use `model_blr1` to create our interval.")
  check_arg(., "level") %>% check_equal(incorrect_msg="Make sure to specify we want a 95% confidence interval. ")
}
ex() %>% check_function("confint") %>% check_result() %>% check_equal()
ex() %>% check_object("NewData1",undefined_msg="Make new data using `NewData1` as the name of the dataframe. ") %>% check_equal(incorrect_msg="Make sure to specify `medhome=50`.")
ex() %>% check_function("predict", not_called_msg="Use `predict` to create prediction intervals using our model and our new data. ") %>% {
  check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify we want to use `model_blr1`.")
  check_arg(., "newdata") %>% check_equal(incorrect_msg="Make sure to specify we want to use `NewData1` as our newdata. ")
  check_arg(., "interval") %>% check_equal(incorrect_msg="Make sure to specify that `interval` should equal `prediction`.")
  check_arg(., "level") %>% check_equal(incorrect_msg="Make sure to specify that we would like a 95% prediction interval. ")
}
ex() %>% check_function("predict") %>% check_result() %>% check_equal()
success_msg("Congratulations! Much of what we learn from a data modeling exercise can be summarized using standard inferential tools: hypothesis testing, confidence intervals, and prediction.")

```

## Diagnostics

***

In this section, you learn how to:

- Describe how diagnostic checking and residual analysis are used in a statistical analysis
- Describe several model misspecifications commonly encountered in a regression analysis

***

###Video 

<center>

<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25916071/partner_id/1660902?iframeembed=true&playerId=kaltura_player&entry_id=0_c6l4p07j&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;&wid=1_4rvf8rp1" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player"></iframe>

</center>

#### Video Overhead Details {-}

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Over2.5A')">A Details. Unusual observations in regression</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5B')">B Details. Example. Outliers and High Leverage Points</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5C')">C Details. Regression fit with 19 base observations</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5D')">D Details. Regression fit with 19 base observations plus C</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5E')">E Details. R code</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5F')">F Details. Visualizing four regression fits</button>
  <button class="tablinks" onclick="openTab(event, 'Over2.5G')">G Details. Results from four regression models</button>  
</div>


<div id="Over2.5A" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>A Details. Unusual observations in regression</h3>
  <p>

- We have defined regression estimates as minimizers of a least squares objective function.
- An appealing intuitive feature of linear regressions is that regression estimates can be expressed as weighted averages of outcomes.
- The weights vary by observation, some observations are more important than others. 
- "Unusual" observations are far from the majority of the data set:
   - Unusual in the vertical direction is called an *outlier*. 
   - Unusual in the horizontal directional is called a *high leverage point*. 
   
</p>
</div>


<div id="Over2.5B" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>B Details. Example. Outliers and High Leverage Points</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
outlr <- read.csv("CSVData\\Outlier.csv", header = TRUE)

#  FIGURE 2.7
plot(outlr$x, outlr$y, xlim = c(0, 10), ylim = c(2, 9), xlab = "x", ylab = "y")
text(4.5, 8.0, "A")
text(9.8, 8.0, "B")
text(9.8, 2.5, "C")
```

</p>
</div>

<div id="Over2.5C" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>C Details. Regression fit with 19 base observations</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_outlr0 <- lm(y ~ x, data = outlr, subset = -c(20,21,22))
summary(model_outlr0)
plot(outlr$x[1:19], outlr$y[1:19], xlab = "x", ylab = "y", xlim = c(0, 10), ylim = c(2, 9))
abline(model_outlr0)

```

</p>
</div>

<div id="Over2.5D" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>D Details. Regression fit with 19 base observations plus C</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_outlrC <- lm(y ~ x, data = outlr, subset = -c(20,21))
summary(model_outlrC)
plot(outlr$x[c(1:19,22)], outlr$y[c(1:19,22)], xlab = "x", ylab = "y", xlim = c(0, 10), ylim = c(2, 9))
text(9.8, 2.5, "C", col = "blue")
abline(model_outlrC)

```

</p>
</div>

<div id="Over2.5E" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>E Details. R code</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
model_outlr0 <- lm(y ~ x, data = outlr, subset = -c(20,21,22))
summary(model_outlr0)
model_outlrA <- lm(y ~ x, data = outlr, subset = -c(21,22))
summary(model_outlrA)
model_outlrB <- lm(y ~ x, data = outlr, subset = -c(20,22))
summary(model_outlrB)
model_outlrC <- lm(y ~ x, data = outlr, subset = -c(20,21))
summary(model_outlrC)
```

</p>
</div>

<div id="Over2.5F" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>F Details. Visualizing four regression fits</h3>
  <p>

```{r comment = "", eval = EVALUATE_CHAP2}
plot(outlr$x, outlr$y, xlim = c(0, 10), ylim = c(2, 9), xlab = "x", ylab = "y")
text(4.5, 8.0, "A", col = "red")
text(9.8, 8.0, "B", col = "green")
text(9.8, 2.5, "C", col = "blue")
abline(model_outlr0)
abline(model_outlrA, col = "red")
abline(model_outlrB, col = "green")
abline(model_outlrC, col = "blue")

```

</p>
</div>

<div id="Over2.5G" class="tabcontent">
  <span onclick="this.parentElement.style.display='none'" class="topright">Hide</span>
  <h3>G Details. Results from four regression models</h3>
  <p>

$$\begin{matrix}
\begin{array}{c}
\text{Results from Four Regressions}
\end{array}\\\scriptsize
\begin{array}{l|rrrrr} \hline \text{Data} & b_0 & b_1 & s & R^2(\%) & t(b_1) \\ \hline \text{19 Base Points} & 1.869 & 0.611 & 0.288 & 89.0 & 11.71 \\ \text{19 Base Points} ~+~ A & 1.750 & 0.693 & 0.846 & 53.7 & 4.57 \\ \text{19 Base Points} ~+~ B & 1.775 & 0.640 & 0.285 & 94.7 & 18.01 \\ \text{19 Base Points} ~+~ C & 3.356 & 0.155 & 0.865 & 10.3 & 1.44 \\ \hline \end{array} 
\end{matrix}$$

</p>
</div>

###Exercise. Assessing outliers in lottery sales

**Assignment Text**
  
In an earlier video, we made a scatter plot of population versus sales. This plot exhibits an outlier; the point in the upper left-hand side of the plot represents a zip code that includes Kenosha, Wisconsin. Sales for this zip code are unusually high given its population.  

This exercise summarizes the regression fit both with and without this zip code in order to see how robust our results are to the inclusion of this unusual observation. 

**Instructions**

- A basic linear regression fit of population on sales has already been fit in the object `model_blr`. Re-fit this same model to the data, this time omitting Kenosha (observation number 9).
- Plot these two least squares fitted lines superimposed on the full data set.
- What is the effect on the distribution  of residuals by removing this point? Calculate a normal qq plot with and without Kenosha.

```{r ex="ExerRegMod2.5.2", type="hint", tut=TRUE}
You can extract the residuals from a regression object with the function [residuals()].
```

```{r ex="ExerRegMod2.5.2", type="pre-exercise-code", tut=TRUE}
#Lot <- read.csv("CSVData\\Wisc_lottery.csv", header = TRUE)
Lot <- read.csv("https://assets.datacamp.com/production/repositories/2610/datasets/a792b30fb32b0896dd6894501cbab32b5d48df51/Wisc_lottery.csv", header = TRUE)
```

```{r ex="ExerRegMod2.5.2", type="sample-code", tut=TRUE}
model_blr <-lm(sales ~ pop, data = Lot)
summary(model_blr)
# Re-fit this model to the data, this time omitting Kenosha (observation number 9).
model_Kenosha <- lm(___ ~ ___, data = Lot, subset = -c(9))
summary(___)

# Plot these two least squares fitted lines superimposed on the full data set.
plot(___, ___, xlab = "population", ylab = "sales")
text(5000, 24000, "Kenosha")
abline(model_blr, col="blue")
abline(___, col="red")

# Calculate a normal qq plot with and without Kenosha.
par(mfrow = c(1, 2))
qqnorm(residuals(___), main = "")
qqline(residuals(___)))
qqnorm(residuals(___)), main = "")
qqline(residuals(___)))

```

```{r ex="ExerRegMod2.5.2", type="solution", tut=TRUE}
model_blr <-lm(sales ~ pop, data = Lot)
summary(model_blr)
model_Kenosha <- lm(sales ~ pop, data = Lot, subset = -c(9))
summary(model_Kenosha)

plot(Lot$pop, Lot$sales, xlab = "population", ylab = "sales")
text(5000, 24000, "Kenosha")
abline(model_blr, col="blue")
abline(model_Kenosha, col="red")

par(mfrow = c(1, 2))
qqnorm(residuals(model_blr), main = "")
qqline(residuals(model_blr))
qqnorm(residuals(model_Kenosha), main = "")
qqline(residuals(model_Kenosha))

```


```{r ex="ExerRegMod2.5.2", type="sct", tut=TRUE}
ex() %>% check_object("model_blr", undefined_msg="Make sure to name the first regression model `model_blr`.") %>% check_equal(incorrect_msg="This has already been bone for you, please do not change it.")
ex() %>% check_function("lm", index=1, not_called_msg="Use `lm` to create the linear model for `model_blr`.") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="Make sure to model `sales` based on `pop`.")
  check_arg(., "data") %>% check_equal(incorrect_msg="Make sure to specify the dataframe we are using, `Lot`.")
}
ex() %>% check_function("summary", index=1, not_called_msg="run `summary` on `model_blr`.") %>% check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify that we want the summary of `model_blr`.")
ex() %>% check_object("model_Kenosha", undefined_msg="Name the result of a `lm` excluding Kenosha `model_Kenosha`.") %>% check_equal(incorrect_msg="Make sure to exclude observation 9.")
ex() %>% check_function("lm", index=2, not_called_msg="Create a linear model excluding the Kenosha observation.") %>% {
  check_arg(., "formula") %>% check_equal(incorrect_msg="Make sure to specify that we want to base `sales` on `pop`.")
  check_arg(., "data") %>% check_equal(incorrect_msg="Make sure to specify that our data is from the dataframe `Lot`.")
  check_arg(., "subset") %>% check_equal(incorrect_msg="Make sure to remove the Kenosha observation from the data. Kenosha is observation 9.")
}
ex() %>% check_function("summary", index=2, not_called_msg="Look at the summary stats of `model_Kenosha` using `summary`.") %>% check_arg(., "object") %>% check_equal(incorrect_msg="Make sure to specify we want summary stats of `model_Kenosha`." )
ex() %>% check_function("plot", not_called_msg="Create a plot of population vs sales from the full data. ") %>% {
  check_arg(., "x") %>% check_equal(incorrect_msg="The x variable should be all of the population observations. ")
  check_arg(., "y") %>% check_equal(incorrect_msg="The y variable should be all of the sales observations. ")
}
ex() %>% check_function("abline", index=1, not_called_msg="plot the regression of `model_blr` using `abline`.") %>% check_arg(., "a") %>% check_equal(incorrect_msg="The first line should be for `model_blr`.")
ex() %>% check_function("abline", index=2, not_called_msg="plot the regression of `model_Kenosha` using `abline`.") %>% check_arg(., "a") %>% check_equal(incorrect_msg="The second line should be for `model_Kenosha`.")
ex() %>% check_function("par", not_called_msg="Set up the plotting window so it has 2 graphs using `par`.") %>% check_arg(., "mfrow") %>% check_equal(incorrect_msg="Make sure to create 2 side-by-side graphs! ")
ex() %>% check_function("qqnorm", index=1, not_called_msg="Create a qq-plot for `model_blr` using `qqnorm`.") %>% check_arg(., "y") %>% check_equal(incorrect_msg="The first graph should be for `model_blr`.")
ex() %>% check_function("qqline", index=1, not_called_msg="Add a qq-line to the graph for `model_blr`.") %>% check_arg(., "y") %>% check_equal(incorrect_msg="The first line should be for `model_blr`.")
ex() %>% check_function("qqnorm", index=2, not_called_msg="Create a qq-plot for `model_Kenosha` using `qqnorm`.") %>% check_arg(.,"y") %>% check_equal(incorrect_msg="The second graph should be for `model_Kenosha`.")
ex() %>% check_function("qqline", index=2, not_called_msg="Add a qq-line to the graph for `model_Kenosha`.") %>% check_arg(., "y") %>% check_equal(incorrect_msg="The second line should be for `model_Kenosha`.")
success_msg("Congratulations! Just because an observation is unusual does not make it bad or noninformative. Kenosha is close to the Illinois border; residents from Illinois probably participate in the Wisconsin lottery thus effectively increasing the potential pool of sales in Kenosha. Although unusual, there is interesting information to be learned from this observation.")
```

